<html>
<head>
    <script src="plotly-latest.min.js"></script>
    <script src="jquery.min.js"></script>
</head>
<body>

    <select id="plotax_select">
        <option value="shared_hets">shared hets</option>
        <option value="shared_hom_alts">shared hom-alts</option>
        <option value="concordance">homozygous concordance</option>
        <option value="relatedness">relatedness</option>
        <option value="ibs0" selected>IBS0</option>
        <option value="ibs2">IBS2</option>
    </select>
    <select id="plotay_select">
        <option value="shared_hets">shared hets</option>
        <option value="shared_hom_alts">shared hom-alts</option>
        <option value="concordance" selected >homozygous concordance</option>
        <option value="relatedness">relatedness</option>
        <option value="ibs0">IBS0</option>
        <option value="ibs2" selected>IBS2</option>
    </select>

    <div id="plota"></div>

    <select id="plotb_select">
        <option value="shared_hets">shared hets</option>
        <option value="shared_hom_alts">shared hom-alts</option>
        <option value="concordance" selected >homozygous concordance</option>
        <option value="relatedness">relatedness</option>
        <option value="ibs0">IBS0</option>
        <option value="ibs2">IBS2</option>
    </select>

    <div id="plotb"></div>

    <script src="results.js"></script>
    <script>

var input = {"sites_tested":468,"ibs":[0,0,21,21,20,14,13,13,14,12,89,0,20,20,19,14,13,13,15,13,38,39,0,0,0,13,9,11,19,18,35,35,101,0,0,13,9,11,19,18,33,33,100,95,0,13,9,11,17,17,37,36,48,42,45,0,0,0,16,14,33,35,47,41,46,99,0,0,13,12,33,32,43,40,40,94,90,0,15,14,41,43,49,48,46,44,44,38,0,0,37,39,47,46,45,42,42,38,110,0],"n":[0,280,289,284,268,287,255,276,291,279,279,0,282,271,259,278,250,265,282,271,145,147,0,282,270,285,254,274,289,280,143,140,280,0,262,276,246,277,281,272,130,131,267,259,0,264,247,258,269,267,151,148,159,152,144,0,256,270,289,275,133,134,143,138,141,254,0,249,257,254,151,144,152,153,139,269,244,0,275,269,151,153,148,148,140,141,132,136,0,283,147,148,146,146,141,136,129,137,281,0],"hets":[93,93,111,103,104,107,103,98,118,111],"homs":[73,72,79,81,79,74,72,73,71,69],"shared_hom_alts":[0,69,43,45,43,42,42,44,46,45,0,0,42,43,43,42,42,42,45,43,0,0,0,77,76,46,45,46,47,46,0,0,0,0,76,45,46,48,51,49,0,0,0,0,0,44,46,44,47,46,0,0,0,0,0,0,69,70,40,37,0,0,0,0,0,0,0,66,41,39,0,0,0,0,0,0,0,0,43,40,0,0,0,0,0,0,0,0,0,68,0,0,0,0,0,0,0,0,0,0],"samples":["15079X17","15079X2","15079X19","15079X25","15079X22","15079X20","15079X23","15079X26","15079X21","15079X24"],"clusters":[[0,1],[2,3,4],[5,6,7],[8,9]]}
input.n_samples = input.samples.length;

function tosquare(arr, n) {
    var out = new Array(n)
    var i, j;
    for (i = 0; i < n; i++) {
        var row = new Array(n);
        for(j = 0; j < n; j++) {
            row[j] = arr[i * n + j];
        }
        out[i] = row;
    }
    return out
}

//input.ibs = tosquare(input.ibs, input.n_samples)
//input.shared_hom_alts = tosquare(input.shared_hom_alts, input.n_samples)
//input.n = tosquare(input.n, input.n_samples)


var accessors = {
    "ibs0": function (input, i, j) {
        return input.ibs[i * input.n_samples + j]
    },
    "shared_hets": function (input, i, j) {
        return input.ibs[j * input.n_samples + i]
    },
    "ibs2": function (input, i, j) {
        return input.n[j * input.n_samples + i]
    },
    "n": function (input, i, j) {
        return input.n[i * input.n_samples + j]
    },
    "shared_hom_alts": function (input, i, j) {
        return input.shared_hom_alts[i * input.n_samples + j]
    },
    "relatedness": function(input, i, j) {
        return (accessors.shared_hets(input, i, j) - 2 * accessors.ibs0(input, i, j)) / Math.min(input.hets[i], input.hets[j])
    },
    "concordance": function(input, i, j) {
        return accessors.shared_hom_alts(input, i, j) / Math.min(input.homs[i], input.homs[j])
    },
}

function get_heat_data(input, metric) {
    var result = new Array(input.n_samples)
    for (i = 0; i < input.n_samples; i++) {
        result[i] = new Array(input.n_samples)
    }
    for (i = 0; i < input.n_samples; i++) {
        for (j = i + 1; j < input.n_samples; j++) {
            result[i][j] = accessors[metric](input, i, j)
        }
    }
    return result
}

var colorscaleValue = [
  [0, '#3D9970'],
  [1, '#001f3f']
];

var metric_b = jQuery("#plotb_select").val()

var heat_data = {
    z: get_heat_data(input, "relatedness"),
    type: 'heatmap',
    x: input.samples,
    colorscale: colorscaleValue,
    y: input.samples
}

var layout_b = {
    title: jQuery("#plotb_select option:selected").text(),
    xaxis: {
        tickangle: 90,
    }
}

Plotly.newPlot('plotb', [heat_data], layout_b)

jQuery('#plotb_select').on('change', function() {
    var metric = this.value
    layout_b.title = jQuery("#plotb_select option:selected").text();
    heat_data.z = get_heat_data(input, metric)
    Plotly.redraw('plotb')
})


</script>
</body>
</html>
